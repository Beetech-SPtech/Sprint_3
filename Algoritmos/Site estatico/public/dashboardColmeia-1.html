<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <link rel="stylesheet" href="styles/dashboardColmeia1.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body onload="buscarDadosGraficoColmeia1()">
    <div class="ajuda"><a href="https://beetechsp.atlassian.net/servicedesk/customer/portal/2/user/login?destination=portal%2F2">Precisa de ajuda?</a><i class="fas fa-headset"></i></div>
    <div class="left-bar">
        <img src="assets/images/beetech-logo.png" alt="" />

        <p>Dashboard específica da colmeia 1.</p>
        <a href="dashboardGeral.html"><button>Voltar</button></a>
    </div>
    <div class="container-main">
        <div class="container-top">
            <h1>Métricas:</h1>
            <div class="container-metricas">
                <div class="box-1">
                    <h2><b>Alerta</b></h2>
                    <p>Abaixo de 30°C.</p>
                </div>
                <div class="box-2">
                    <h2><b>Preocupante</b></h2>
                    <p>Abaixo de 33°C.</p>
                </div>
                <div class="box-3">
                    <h2><b>Ideal</b></h2>
                    <p>Entre 33°C - 36°C.</p>
                </div>
                <div class="box-4">
                    <h2><b>Preocupante</b></h2>
                    <p>Acima de 36°C.</p>
                </div>
                <div class="box-5">
                    <h2><b>Alerta</b></h2>
                    <p>Acima de 39 °C.</p>
                </div>
            </div>
        </div>
        <div class="container-dados">
            <h1>Registros:</h1>
            <div class="container-registros">
                <div id="div_registro1" class="registro-1">
                    <p>Temperatura atual: <br>
                    <h2 id="h2_registro1">32°C</h2>
                    </p>
                </div>

                <div  id="div_registro2"class="registro-2">
                    <p>Média dos últimos 15 minutos:<br>
                    <h2 id="h2_registro2">34°C</h2>
                    </p>
                </div>

                <div id="div_registro3"class="registro-3">
                    <p>Menor temperatura dos últimos 15 minutos: <br>
                    <h2 id="h2_registro3">32°C</h2>
                    </p>
                </div>


                <div id="div_registro4"class="registro-4">
                    <p>Maior temperatura dos últimos 15 minutos: <br>
                    <h2 id="h2_registro4">37°C</h2>
                    </p>
                </div>

                <div id="div_registro5"class="registro-5  ">
                    <p>Total de alertas emitidos no dia: <br>
                    <h2>1</h2>
                    </p>
                </div>
            </div>

            <div class="graficos">
                <div class="grafico-1">
                    <h3>Temperatura da colmeia 1</h3>
                    <canvas id="grafico-1"></canvas>
                </div>
                <div class="grafico-2">
                    <h3>Histórico de Alertas</h3>
                    <canvas id="grafico-2"></canvas>
                </div>
            </div>

        </div>



    </div>
</body>

</html>
<script>
    const ctx = document.getElementById('grafico-1');
    const ctx2 = document.getElementById('grafico-2');


var graficoLinha1 = null; 
var listaMinutos = [];
var listaTemperaturas = [];

function buscarDadosGraficoColmeia1() {
    fetch('/dashboardColmeia1/grafico15colmeia1').then(function(response){
        if (response.ok) {
            response.json().then(function(resposta){

                console.log("grafico: ", resposta);

               
                listaMinutos = [];
                listaTemperaturas = [];

                
                for (var i = 0; i < resposta.length; i++) {
                    listaMinutos.push(resposta[i].minuto);
                    listaTemperaturas.push(parseFloat(resposta[i].temperatura));
                }

                plotarGraficoColmeia1(listaMinutos, listaTemperaturas);

            });
        }
    });
}


function plotarGraficoColmeia1(listaMinutos, listaTemperaturas) {

    if (graficoLinha1 != null) {
        graficoLinha1.destroy();
    }

    graficoLinha1 = new Chart(ctx, {
        type: 'line',
        data: {
            labels: listaMinutos,
            datasets: [{
                label: 'Temperatura (°C)',
                data: listaTemperaturas,
                borderWidth: 2,
                borderColor: 'black',
                backgroundColor: '#B22222'
            }]
        },
        options: {
            scales: { y: { beginAtZero: false } }
        }
    });

    // Atualiza automaticamente
    setTimeout(() => buscarDadosGraficoColmeia1(), 1000);
}



    new Chart(ctx2, {
        type: 'bar',
        data: {
 labels: ['Segunda', 'Terça', 'Quarta','Quinta','Sexta','Sabado','Domingo'],
            datasets: [{
                label: 'Quantidade de alertas.',
                data: [0, 1, 2,2,1,0,0],
                borderWidth: 1,
                color: '#e74c3c',
                backgroundColor: '#B22222',
                borderColor:'black'

            }]
        },
        options: {
            scales: {
                y: {
                   beginAtZero: true,
                    ticks: {
                        precision:0
                    }
            }}
        }
    });
var registro1 = document.getElementById('div_registro1')
var registro2 = document.getElementById('div_registro2')
var registro3 = document.getElementById('div_registro3')
var registro4 = document.getElementById('div_registro4')
var registro5 = document.getElementById('div_registro5')

function trocarBackgroundImg(tempAtual,registroId){
             if(tempAtual>39 || tempAtual<30){
      registroId.style.backgroundImage = 'url(assets/images/hexagono-vermelho2.svg)'
    }else if(tempAtual<33 || tempAtual>36){
      registroId.style.backgroundImage = 'url(assets/images/hexagono-amarelo2.svg)'
    }else{
      registroId.style.backgroundImage ='url(assets/images/hexagono-verde2.svg)'
    }
}


    function buscarTemperaturaColmeia1(){
    fetch('/dashboardGeral/buscarTemperaturaAtualColmeia1').then(function(response){
      if(response.ok){
        response.json().then(function(resposta){
          console.log(resposta[0].valorTemp)
          h2_registro1.innerHTML  = `${resposta[0].valorTemp}ºC`
         
          trocarBackgroundImg(resposta[0].valorTemp,registro1)
          
          setTimeout(() => {
            buscarTemperaturaColmeia1()
          }, 1000);
        })

      }
    })
  }

  function media15colmeia1(){
     fetch('/dashboardColmeia1/media15colmeia1').then(function(response){
      if(response.ok){
        response.json().then(function(resposta){
          console.log(resposta[0].temperaturaMedia)
          h2_registro2.innerHTML  = `${resposta[0].temperaturaMedia }ºC`
         
          trocarBackgroundImg(resposta[0].temperaturaMedia ,registro2)
          
          setTimeout(() => {
            media15colmeia1()
          }, 10000);
        })

      }
    })
  }
    function menor15colmeia1(){
     fetch('/dashboardColmeia1/menor15colmeia1').then(function(response){
      if(response.ok){
        response.json().then(function(resposta){
          console.log(resposta[0].menorTemp15min)
          h2_registro3.innerHTML  = `${resposta[0].menorTemp15min }ºC`
         
          trocarBackgroundImg(resposta[0].menorTemp15min ,registro3)
          
          setTimeout(() => {
            menor15colmeia1()
          }, 10000);
        })

      }
    })
  }
function maior15colmeia1() {
  fetch('/dashboardColmeia1/maior15colmeia1').then(function(response){
    if (response.ok) {
      response.json().then(function(resposta){

        console.log(resposta[0].maiorTemp15min);
        h2_registro4.innerHTML = `${resposta[0].maiorTemp15min}ºC`;

        trocarBackgroundImg(resposta[0].maiorTemp15min, registro4);

        setTimeout(() => {
          maior15colmeia1();
        }, 10000);
      });
    }
  });
}
  buscarTemperaturaColmeia1();
media15colmeia1();
menor15colmeia1();
maior15colmeia1();
buscarDadosGraficoColmeia1();
</script>